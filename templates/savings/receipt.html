{% extends "base.html" %}

{% block title %}Struk Transaksi{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-gradient text-white text-center" 
                     style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h4 class="mb-0 fw-bold">
                        <i class="bi bi-receipt-cutoff"></i> STRUK TRANSAKSI
                    </h4>
                </div>

                <div class="card-body p-4" id="receipt-content" style="background: #fafafa;">
                    <!-- Business Header -->
                    <div class="text-center mb-4 pb-3 border-bottom border-2">
                        <h2 class="fw-bold text-primary mb-2">{{ business.business_name }}</h2>
                        {% if business.address %}
                        <p class="mb-1 text-muted">
                            <i class="bi bi-geo-alt"></i> {{ business.address }}
                        </p>
                        {% endif %}
                        {% if business.phone %}
                        <p class="mb-1 text-muted">
                            <i class="bi bi-telephone"></i> {{ business.phone }}
                        </p>
                        {% endif %}
                        {% if business.website %}
                        <p class="mb-0 text-muted">
                            <i class="bi bi-globe"></i> {{ business.website }}
                        </p>
                        {% endif %}
                    </div>

                    <!-- Transaction Header -->
                    <div class="row g-3 mb-4">
                        <div class="col-6">
                            <div class="bg-white p-3 rounded shadow-sm">
                                <small class="text-muted">No. Transaksi</small>
                                <div class="fw-bold fs-6">#{{ transaction.id }}</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-white p-3 rounded shadow-sm">
                                <small class="text-muted">Tanggal & Waktu</small>
                                <div class="fw-bold fs-6">{{ transaction.date.strftime('%d/%m/%Y') }}</div>
                                <small class="text-muted">{{ transaction.created_at.strftime('%H:%M:%S') }}</small>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Info -->
                    <div class="bg-white p-3 rounded shadow-sm mb-4">
                        <small class="text-muted">Nama Penabung</small>
                        <div class="fw-bold fs-5 text-primary">
                            <i class="bi bi-person-circle"></i> {{ transaction.saver.name }}
                        </div>
                    </div>

                    <!-- Transaction Details -->
                    <div class="row g-3 mb-4">
                        <div class="col-6">
                            <div class="bg-white p-3 rounded shadow-sm text-center">
                                <small class="text-muted">Jenis Transaksi</small>
                                {% if transaction.type == 'deposit' %}
                                <div class="badge bg-success fs-6 fw-bold mt-1">
                                    <i class="bi bi-arrow-down-circle"></i> SETORAN
                                </div>
                                {% else %}
                                <div class="badge bg-danger fs-6 fw-bold mt-1">
                                    <i class="bi bi-arrow-up-circle"></i> PENARIKAN
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="bg-white p-3 rounded shadow-sm text-center">
                                <small class="text-muted">Jumlah</small>
                                <div class="fs-4 fw-bold text-primary mt-1">
                                    {{ format_currency(transaction.amount) }}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Balance Info -->
                    <div class="bg-success bg-opacity-10 p-3 rounded shadow-sm mb-4 text-center border border-success border-opacity-25">
                        <small class="text-success fw-bold">Saldo Setelah Transaksi</small>
                        <div class="fs-3 fw-bold text-success mt-1">
                            <i class="bi bi-wallet2"></i> {{ format_currency(transaction.balance_after) }}
                        </div>
                    </div>

                    {% if transaction.description %}
                    <div class="bg-white p-3 rounded shadow-sm mb-4">
                        <small class="text-muted">Keterangan</small>
                        <div class="mt-1">{{ transaction.description }}</div>
                    </div>
                    {% endif %}

                    <!-- Footer -->
                    <div class="text-center pt-3 border-top border-2">
                        <p class="mb-2 text-success fw-bold">
                            <i class="bi bi-check-circle"></i> Transaksi Berhasil
                        </p>
                        <p class="mb-1 small text-muted">
                            Dicetak pada: {{ datetime.now().strftime('%d/%m/%Y %H:%M:%S') }}
                        </p>
                        <p class="text-muted fst-italic mb-2">
                            <i class="bi bi-heart"></i> Terima kasih atas kepercayaan Anda!
                        </p>
                        {% if business.copyright_text %}
                        <p class="text-muted small mb-0">{{ business.copyright_text }}</p>
                        {% endif %}
                    </div>
                </div>

                <div class="card-footer bg-light border-0">
                    <div class="d-flex flex-wrap justify-content-between gap-2">
                        <a href="{{ url_for('savings') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> Kembali
                        </a>
                        <div class="d-flex gap-2">
                            <button onclick="window.print()" class="btn btn-primary">
                                <i class="bi bi-printer"></i> Cetak
                            </button>
                            <a href="{{ url_for('savings_receipt', transaction_id=transaction.id, format='pdf') }}" 
                               class="btn btn-success">
                                <i class="bi bi-file-earmark-pdf"></i> PDF
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
@media print {
    .card-header, .card-footer, .btn, .container {
        display: none !important;
    }

    .card {
        border: none !important;
        box-shadow: none !important;
        width: 100% !important;
        margin: 0 !important;
    }

    .card-body {
        padding: 0 !important;
        background: white !important;
    }

    body {
        background: white !important;
        font-size: 12pt !important;
    }

    .shadow-sm, .shadow-lg {
        box-shadow: none !important;
    }

    .bg-gradient {
        background: white !important;
        color: black !important;
    }
}

/* Custom styling for professional look */
.bg-gradient {
    position: relative;
    overflow: hidden;
}

.bg-gradient::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
    opacity: 0.3;
}

.card-body .bg-white {
    transition: transform 0.2s ease;
}

.card-body .bg-white:hover {
    transform: translateY(-1px);
}
</style>
{% endblock %}